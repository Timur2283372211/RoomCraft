import"./modulepreload-polyfill-3cfb730f.js";const t=new fabric.Canvas("canvas",{selection:!0,preserveObjectStacking:!0,isDrawingMode:!1,imageSmoothingEnabled:!0,renderOnAddRemove:!0,skipOffscreen:!1});typeof window.ethereum<"u"?console.log("MetaMask is installed!"):console.log("Please install MetaMask!");const S=document.getElementById("add-circle-btn"),j=document.getElementById("add-rect-btn"),D=document.getElementById("add-triangle-btn"),M=document.getElementById("add-line-btn"),R=document.getElementById("add-star-btn"),U=document.getElementById("add-ellipse-btn"),T=document.getElementById("add-polygon-btn"),W=document.getElementById("add-sofa-btn"),Y=document.getElementById("add-toilet-btn"),X=document.getElementById("add-printer-btn"),q=document.getElementById("delete-selected-btn");q.addEventListener("click",te);S.addEventListener("click",J);j.addEventListener("click",H);D.addEventListener("click",N);M.addEventListener("click",F);R.addEventListener("click",G);U.addEventListener("click",K);T.addEventListener("click",Q);W.addEventListener("click",V);Y.addEventListener("click",_);X.addEventListener("click",ee);const C=t.width,I=t.height,$=100,z=100;function Z(){t.clear();for(let e=0;e<=I+1e5;e=e+z){const n=new fabric.Line([-1e5,e-5e4,C+1e5,e-5e4],{stroke:"#ccc",strokeWidth:2,protected:!0,selectable:!1});t.add(n),t.sendToBack(n)}for(let e=0;e<=C+1e5;e=e+$){const n=new fabric.Line([e-5e4,9e4,e-5e4,I-1e5],{stroke:"#ccc",strokeWidth:2,protected:!0,selectable:!1});t.add(n),t.sendToBack(n)}t.renderAll()}function H(){const e=new fabric.Rect({left:100,top:100,width:60,height:40,fill:"lightblue",stroke:"black",strokeWidth:1,angle:0,scaleX:1,scaleY:1,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function J(){const e=new fabric.Circle({left:200,top:200,radius:30,fill:"lightgreen",stroke:"black",strokeWidth:1,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function N(){const e=new fabric.Triangle({left:200,top:100,width:60,height:50,fill:"pink",stroke:"black",strokeWidth:1,angle:0,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function F(){const e=new fabric.Line([50,50,200,50],{stroke:"red",strokeWidth:3,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function G(){const e=new fabric.Path("M 100 10 L 123 70 L 188 70 L 138 107 L 158 170 L 100 135 L 42 170 L 62 107 L 12 70 L 77 70 Z",{left:250,top:100,fill:"gold",stroke:"black",strokeWidth:1,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function K(){const e=new fabric.Ellipse({left:300,top:150,rx:40,ry:25,fill:"lightcoral",stroke:"black",strokeWidth:1,angle:0,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function Q(){const e=new fabric.Polygon([{x:350,y:100},{x:380,y:120},{x:380,y:150},{x:350,y:170},{x:320,y:150},{x:320,y:120}],{fill:"lightseagreen",stroke:"black",strokeWidth:1,hasControls:!0,hasBorders:!0});t.add(e),t.setActiveObject(e),t.renderAll()}function V(){const e="https://cdn-icons-png.flaticon.com/512/1010/1010398.png";fabric.Image.fromURL(e,function(n){n.set({left:400,top:100,scaleX:.5,scaleY:.5,crossOrigin:"anonymous"}),t.add(n).renderAll()},{crossOrigin:"anonymous"})}function _(){const e="https://cdn-icons-png.flaticon.com/128/1047/1047139.png";fabric.Image.fromURL(e,function(n){n.set({left:400,top:100,scaleX:.5,scaleY:.5,crossOrigin:"anonymous"}),t.add(n).renderAll()},{crossOrigin:"anonymous"})}function ee(){const e="https://cdn-icons-png.flaticon.com/128/2891/2891455.png";fabric.Image.fromURL(e,function(n){n.set({left:400,top:100,scaleX:.5,scaleY:.5,crossOrigin:"anonymous"}),t.add(n).renderAll()},{crossOrigin:"anonymous"})}function te(){const e=t.getActiveObject();e&&(t.remove(e),t.renderAll())}t.on("mouse:wheel",e=>{const n=e.e.deltaY,o=.01;let r=t.getZoom();const s={x:t.getWidth()/2,y:t.getHeight()/2};n>0?(r-=o,r<.1&&(r=.1)):(r+=o,r>3&&(r=3)),t.zoomToPoint(s,r),e.e.preventDefault(),e.e.stopPropagation()});Z();let L=!1,w,E;t.on("mouse:down",e=>{e.e.ctrlKey&&(L=!0,w=e.e.clientX,E=e.e.clientY,t.selection=!1)});t.on("mouse:move",e=>{if(L){const n=e.e.clientX-w,o=e.e.clientY-E;t.relativePan({x:n,y:o}),w=e.e.clientX,E=e.e.clientY}});t.on("mouse:up",()=>{L=!1,t.selection=!0});document.addEventListener("keydown",e=>{e.key==="0"&&(t.setZoom(1),t.viewportTransform=[1,0,0,1,0,0])});let c=[],i=null,b=null,y=!1,l={};document.getElementById("draw-dot-btn").addEventListener("click",P);function P(){y=!y,y?(t.isDrawingMode=!1,t.selection=!1,t.defaultCursor="crosshair",l.mouseDown=e=>{var o;const n=t.getPointer(e.e);if((o=e.target)!=null&&o.isControlPoint){b=e.target.pointIndex;return}c.push({x:n.x,y:n.y}),p(),k()},l.mouseMove=e=>{if(b===null)return;const n=t.getPointer(e.e);c[b]={x:n.x,y:n.y},p(),k()},l.mouseUp=()=>{b=null},l.dblClick=e=>{if(c.length<2)return;const n=t.getPointer(e.e);let o=null,r=1/0;for(let s=0;s<c.length;s++){const a=(s+1)%c.length,d=ne(n,c[s],c[a]);d<r&&(r=d,o=s)}if(o!==null&&r<20){const s=o+1;c.splice(s,0,{x:n.x,y:n.y}),p(),k()}},t.on("mouse:down",l.mouseDown),t.on("mouse:move",l.mouseMove),t.on("mouse:up",l.mouseUp),t.on("mouse:dblclick",l.dblClick)):(t.defaultCursor="default",l.mouseDown&&t.off("mouse:down",l.mouseDown),l.mouseMove&&t.off("mouse:move",l.mouseMove),l.mouseUp&&t.off("mouse:up",l.mouseUp),l.dblClick&&t.off("mouse:dblclick",l.dblClick),l={})}function p(){const e=A(c);i&&t.remove(i),c.length>1&&(i=new fabric.Path(e,{fill:"rgba(100, 200, 255, 0.5)",stroke:"blue",strokeWidth:2,selectable:!0}),t.add(i))}function k(){t.getObjects().filter(e=>e.isControlPoint).forEach(e=>t.remove(e)),c.forEach((e,n)=>{const o=new fabric.Circle({left:e.x,top:e.y,radius:5,fill:"red",originX:"center",originY:"center",isControlPoint:!0,pointIndex:n,selectable:!1,hasControls:!1,hasBorders:!1});t.add(o)})}function A(e,n=!1){if(e.length===0)return"";let o=`M ${e[0].x} ${e[0].y}`;for(let r=1;r<e.length;r++)o+=` L ${e[r].x} ${e[r].y}`;return n?o+" z":o}function ne(e,n,o){const r=e.x-n.x,s=e.y-n.y,a=o.x-n.x,d=o.y-n.y,O=r*a+s*d,B=a*a+d*d;let f=-1;B!==0&&(f=O/B);let m,h;return f<0?(m=n.x,h=n.y):f>1?(m=o.x,h=o.y):(m=n.x+f*a,h=n.y+f*d),Math.sqrt((e.x-m)**2+(e.y-h)**2)}document.getElementById("draw-dot-btn").addEventListener("click",P);document.getElementById("finish").addEventListener("click",()=>{if(c.length>=3){const e=A(c,!0);oe(e)}});function oe(e){i&&t.remove(i),i=new fabric.Path(e,{fill:"rgba(100, 200, 255, 0.5)",stroke:"blue",strokeWidth:2,selectable:!0}),t.add(i)}document.getElementById("save-btn").addEventListener("click",()=>{try{const n=new URLSearchParams(window.location.search).get("id")||re(),o=t.toDataURL({format:"png",quality:.8}),r=JSON.parse(localStorage.getItem("projects")||"{}");r[n]=o,localStorage.setItem("projects",JSON.stringify(r)),alert("Проект успішно збережено!")}catch(e){console.error("Помилка збереження:",e),alert("Сталася помилка при збереженні")}});function re(){return"project-"+Date.now().toString(36)+Math.random().toString(36).substr(2,5)}if(window.location.search.includes("id=")){const e=new URLSearchParams(window.location.search).get("id"),n=JSON.parse(localStorage.getItem("projects")||"{}");n[e]&&fabric.Image.fromURL(n[e],function(o){t.add(o).renderAll()},{crossOrigin:"anonymous"})}document.getElementById("clear-btn").addEventListener("click",()=>{t.getObjects().forEach(e=>{e.protected||t.remove(e)}),t.renderAll()});let u=!1,g=null;document.getElementById("draw-btn").addEventListener("click",function(){u=!u,u?(this.textContent="Зупинити малювання",t.selection=!1,t.defaultCursor="crosshair"):(this.textContent="Режим малювання",t.selection=!0,t.defaultCursor="default")});t.on("mouse:down",function(e){if(!u)return;const n=t.getPointer(e.e);g=new fabric.Path(`M ${n.x} ${n.y}`,{stroke:document.getElementById("color-picker").value,strokeWidth:3,fill:"transparent",selectable:!1}),t.add(g)});t.on("mouse:move",function(e){if(!u||!g)return;const n=t.getPointer(e.e);g.path.push(["L",n.x,n.y]),t.requestRenderAll()});t.on("mouse:up",function(){g=null});let v=null,x=!1;document.getElementById("add-text-btn").addEventListener("click",()=>{x||(v=new fabric.Textbox("Натисніть для редагування",{left:100,top:100,width:200,fontSize:20,fill:"#000000",borderColor:"#3f51b5",cornerColor:"#3f51b5",cornerSize:10,transparentCorners:!1,hasControls:!0,lockUniScaling:!0,padding:5}),t.add(v),t.setActiveObject(v),t.requestRenderAll())});document.getElementById("edit-text-btn").addEventListener("click",()=>{const e=t.getActiveObject();if(!e||!(e instanceof fabric.Textbox)){alert("Виберіть текстовий об'єкт для редагування");return}x=!0,e.enterEditing(),e.hiddenTextarea.focus(),e.on("editing:exited",()=>{x=!1})});t.on("object:selected",e=>{e.target instanceof fabric.Textbox&&(e.target.set({borderColor:"#ff5722",cornerColor:"#ff5722"}),t.requestRenderAll())});t.on("object:modified",e=>{console.log("Об'єкт змінено:",e.target)});
